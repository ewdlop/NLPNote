# 地日月曆(三體) - Three-Body Calendar System

## 概述 Overview

地日月曆（三體）是一個考慮地球、太陽和月球三體引力相互作用的曆法系統，具備自然語言處理能力，支持多語言日期解析和格式化。

The Three-Body Calendar is a calendar system that accounts for the gravitational interactions between Earth, Sun, and Moon, with natural language processing capabilities supporting multilingual date parsing and formatting.

## 特性 Features

### 🌍 天文計算 Astronomical Calculations
- **精確的天體位置計算** - Precise celestial body position calculations
- **月相計算** - Lunar phase calculations  
- **節氣計算** - Solar term calculations (Chinese 24 solar terms)
- **儒略日轉換** - Julian Day conversions

### 🗣️ 自然語言處理 Natural Language Processing
- **多語言支持** - Multilingual support (Chinese & English)
- **日期表達式解析** - Date expression parsing
- **智能文本分析** - Intelligent text analysis
- **語境理解** - Context understanding

### 🔗 系統整合 System Integration
- **與現有NLP工具整合** - Integration with existing NLP tools
- **模組化設計** - Modular design
- **擴展性** - Extensibility

## 核心組件 Core Components

### 1. ThreeBodyCalendar 三體曆法核心類

```python
from ThreeBodyCalendar import ThreeBodyCalendar
import datetime

calendar = ThreeBodyCalendar()

# 獲取當前三體狀態
now = datetime.datetime.now()
state = calendar.get_three_body_state(now)

# 格式化三體日期
formatted_zh = calendar.format_three_body_date(now, 'zh')
formatted_en = calendar.format_three_body_date(now, 'en')
```

### 2. AstronomicalCalculator 天文計算器

負責精確的天體力學計算：
- 太陽位置計算
- 月球位置計算  
- 地球位置計算
- 儒略日轉換

### 3. ThreeBodyDateParser 自然語言解析器

```python
from ThreeBodyCalendar import ThreeBodyDateParser

parser = ThreeBodyDateParser()

# 解析中文日期
result = parser.analyze_date_expression("2024年12月22日")

# 解析英文日期
result = parser.analyze_date_expression("2025-01-01")
```

## 使用示例 Usage Examples

### 基本使用 Basic Usage

```python
#!/usr/bin/env python3
from ThreeBodyCalendar import ThreeBodyCalendar, ThreeBodyDateParser
import datetime

# 創建曆法系統
calendar = ThreeBodyCalendar()
parser = ThreeBodyDateParser()

# 獲取當前三體狀態
now = datetime.datetime.now()
print("當前三體狀態:")
print(calendar.format_three_body_date(now, 'zh'))

# 計算月相
phase_zh, phase_en, ratio = calendar.lunar_phase(now)
print(f"月相: {phase_zh} ({ratio:.1%})")

# 計算節氣
term_zh, term_en = calendar.solar_term(now)
print(f"節氣: {term_zh}")
```

### 自然語言解析 Natural Language Parsing

```python
# 中文日期解析
expressions = [
    "2024年12月22日",
    "2025年春分", 
    "明年冬至",
    "下個滿月"
]

for expr in expressions:
    result = parser.analyze_date_expression(expr)
    if result['parsed_date']:
        print(f"輸入: {expr}")
        print(f"解析: {result['parsed_date']}")
        print(f"三體格式: {result['three_body_format_zh']}")
        print()
```

### 與現有NLP工具整合 Integration with Existing NLP Tools

```python
from SubtextAnalyzer import SubtextAnalyzer
from ThreeBodyCalendar import ThreeBodyCalendar

# 整合分析
def analyze_temporal_expression(text):
    """分析時間表達式的潛文本"""
    subtext_analyzer = SubtextAnalyzer()
    calendar = ThreeBodyCalendar()
    
    # 潛文本分析
    subtext_result = subtext_analyzer.analyze(text)
    
    # 三體曆法分析
    parser = ThreeBodyDateParser()
    temporal_result = parser.analyze_date_expression(text)
    
    return {
        'subtext_analysis': subtext_result,
        'temporal_analysis': temporal_result,
        'integrated_interpretation': combine_analyses(subtext_result, temporal_result)
    }
```

## 天文學背景 Astronomical Background

### 三體問題 Three-Body Problem

三體問題是天體力學中的經典問題，研究三個天體在相互引力作用下的運動。在地日月系統中：

- **地球** - 主要參考框架
- **太陽** - 主要引力源，決定季節變化
- **月球** - 影響潮汐和月相變化

The three-body problem is a classic problem in celestial mechanics studying the motion of three celestial bodies under mutual gravitational influence.

### 曆法意義 Calendar Significance

傳統曆法通常只考慮太陽（陽曆）或月球（陰曆）的運動。三體曆法同時考慮：

1. **太陽運動** - 決定節氣和季節
2. **月球運動** - 決定月相和陰曆月
3. **地球運動** - 參考框架和日夜循環
4. **三體相互作用** - 微妙的引力攝動

## 技術實現 Technical Implementation

### 算法特點 Algorithm Features

1. **簡化的三體力學模型** - Simplified three-body mechanics
2. **高精度天體位置計算** - High-precision celestial position calculation
3. **優化的計算性能** - Optimized computational performance
4. **錯誤處理和降級** - Error handling and graceful degradation

### 數據結構 Data Structures

```python
@dataclass
class CelestialPosition:
    longitude: float  # 經度 (degrees)
    latitude: float   # 緯度 (degrees) 
    distance: float   # 距離 (astronomical units)

@dataclass  
class ThreeBodyState:
    earth: CelestialPosition
    sun: CelestialPosition
    moon: CelestialPosition
    julian_day: float
    gregorian_date: datetime.datetime
```

### 計算公式 Calculation Formulas

#### 儒略日計算 Julian Day Calculation
```
JD = 367 × Y - INT(7 × (Y + INT((M + 9) / 12)) / 4) + INT(275 × M / 9) + D + 1721013.5
```

#### 太陽位置 Solar Position
基於開普勒軌道要素的簡化計算：
- 平近點角 Mean Anomaly
- 偏心率方程 Equation of Center  
- 黃道經度 Ecliptic Longitude

#### 月球位置 Lunar Position
考慮主要攝動項的月球位置計算：
- 主要不等式 Principal inequality
- 出差 Evection
- 年差 Annual equation

## API 參考 API Reference

### ThreeBodyCalendar

#### Methods

- `get_three_body_state(dt: datetime) -> ThreeBodyState`
  - 獲取指定時間的三體系統狀態
  
- `lunar_phase(dt: datetime) -> Tuple[str, str, float]`
  - 計算月相，返回中英文名稱和相位比例
  
- `solar_term(dt: datetime) -> Tuple[str, str]`
  - 計算節氣，返回中英文名稱
  
- `format_three_body_date(dt: datetime, lang: str) -> str`
  - 格式化三體日期字符串

### ThreeBodyDateParser

#### Methods

- `parse_date(text: str) -> Optional[datetime]`
  - 從文本解析日期
  
- `analyze_date_expression(text: str) -> Dict`
  - 分析日期表達式，返回完整分析結果

## 應用場景 Application Scenarios

### 1. 教育應用 Educational Applications
- **天文學教學** - Astronomy education
- **曆法歷史研究** - Calendar history research
- **文化交流** - Cultural exchange

### 2. 文學創作 Literary Creation  
- **科幻小說設定** - Science fiction world-building
- **詩歌創作** - Poetry with astronomical themes
- **傳統文化重現** - Traditional culture recreation

### 3. 學術研究 Academic Research
- **計算語言學** - Computational linguistics
- **天體力學** - Celestial mechanics
- **文化人類學** - Cultural anthropology

### 4. 技術應用 Technical Applications
- **智能日曆系統** - Intelligent calendar systems
- **天文軟體** - Astronomical software
- **多語言處理** - Multilingual processing

## 局限性與改進 Limitations and Improvements

### 當前局限 Current Limitations

1. **簡化的物理模型** - Simplified physical model
2. **有限的語言支持** - Limited language support
3. **基礎的NLP功能** - Basic NLP capabilities
4. **計算精度限制** - Computational precision limits

### 未來改進 Future Improvements

1. **更精確的軌道模型** - More precise orbital models
2. **深度學習NLP** - Deep learning NLP
3. **更多語言支持** - Extended language support
4. **實時天文數據** - Real-time astronomical data
5. **可視化界面** - Visualization interface

## 開發團隊 Development Team

- **三體曆法開發組** - Three-Body Calendar Development Team
- **項目日期** - Project Date: 2024-12-22
- **版本** - Version: 1.0.0

## 相關資源 Related Resources

### 學術參考 Academic References
- Jean Meeus, "Astronomical Algorithms"
- 中國科學院紫金山天文台，《中國天文年曆》
- IAU Recommendations on Astronomical Constants

### 軟體工具 Software Tools
- PyEphem - Astronomical calculations
- Astropy - Professional astronomy library
- NLTK/spaCy - Natural language processing

### 文化背景 Cultural Background
- 中國傳統曆法 - Traditional Chinese Calendar
- 二十四節氣 - 24 Solar Terms
- 月相文化 - Lunar phase culture

---

*此文檔是三體曆法系統的完整技術和使用指南。如有問題或建議，請聯繫開發團隊。*

*This document is a complete technical and usage guide for the Three-Body Calendar System. For questions or suggestions, please contact the development team.*